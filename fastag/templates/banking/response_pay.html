{% extends 'base.html' %}
{% block title %}Response Pay - Banking{% endblock %}
{% block content %}
<style>
  .table-sm, .table-sm th, .table-sm td { font-size: 0.92rem; padding: 0.25rem 0.5rem; }
  .filter-bar { margin-bottom: 0.5rem; font-size: 0.98rem; }
  .action-icon-btn { background: none; border: none; padding: 0.2rem 0.4rem; font-size: 1.1rem; cursor: pointer; }
  .action-icon-btn:focus { outline: none; }
  #response, .table-sm { font-size: 0.95rem; }
</style>
<div class="container mt-3">
  <h4 style="font-size:1.2rem; font-weight:600; margin-bottom:0.7rem;">Response Pay</h4>
  <div class="filter-bar d-flex align-items-center">
    <form method="get" class="d-flex align-items-center" style="gap:0.5rem;">
      <label for="date" class="me-2 mb-0">Show for date:</label>
      <input type="date" id="date" name="date" value="{{ selected_date }}" class="form-control form-control-sm" style="width: 160px;">
      <button type="submit" class="btn btn-outline-primary btn-sm">Filter</button>
    </form>
    <span class="ms-auto text-muted" style="font-size:0.93rem;">Powered by Onebee Technology Pvt Ltd</span>
  </div>
  <form method="post" id="statusForm">
    <table class="table table-bordered table-sm align-middle">
      <thead>
        <tr>
          <th style="width:2.5rem;">ID</th>
          <th>Msg ID</th>
          <th>Org ID</th>
          <th>Tag ID</th>
          <th>TID</th>
          <th>Vehicle No</th>
          <th>Amount</th>
          <th>Time</th>
          <th style="width:2.5rem; text-align:center;">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.id }}</td>
          <td>{{ log.msg_id }}</td>
          <td>{{ log.org_id }}</td>
          <td>{{ log.tag_id }}</td>
          <td>{{ log.tid }}</td>
          <td>{{ log.vehicle_reg_no }}</td>
          <td>{{ log.amount }}</td>
          <td>{{ log.request_time }}</td>
          <td style="text-align:center;">
            {% if status_map[log.id] is defined %}
              <button type="submit" name="log_id" value="{{ log.id }}" class="action-icon-btn" title="View Status">
                <i class="fas fa-eye"></i>
              </button>
            {% else %}
              <button type="submit" name="log_id" value="{{ log.id }}" class="action-icon-btn" title="Get Status">
                <i class="fas fa-sync-alt"></i>
              </button>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
  <h6 style="font-size:1.05rem; margin-top:1.2rem;">Response</h6>
  <div id="response" style="font-size:0.97rem;">
    {% if response %}
      <pre style="font-size:0.97rem; margin-bottom:0.5rem;">{{ response|safe }}</pre>
    {% endif %}
  </div>
  {% if status_list %}
  <h6 style="font-size:1.05rem; margin-top:0.7rem;">Transaction Status Details</h6>
  <table class="table table-bordered table-sm">
    <thead>
      <tr>
        <th>txnId</th>
        <th>result</th>
        <th>errCode</th>
        <th>txnStatus</th>
        <th>plazaId</th>
        <th>laneId</th>
        <th>settleDate</th>
        <th>txnDate</th>
        <th>txnlist_FareType</th>
        <th>txnlist_RegNumber</th>
        <th>txnlist_TollFare</th>
        <th>txnlist_VehicleClass</th>
        <th>txnlist_errCode</th>
        <th>txnlist_txnReaderTime</th>
        <th>txnlist_txnReceivedTime</th>
        <th>txnlist_txnStatus</th>
        <th>txnlist_txnType</th>
      </tr>
    </thead>
    <tbody>
      {% for s in status_list %}
      <tr>
        <td>{{ s.txnId|default('') }}</td>
        <td>{{ s.result|default('') }}</td>
        <td>{{ s.errCode|default('') }}</td>
        <td>
          {% set txs = s.txnlist_txnStatus|default('') %}
          {% if txs == 'FAILURE' %}
            <b style="color: red">{{ txs }}</b>
          {% elif txs == 'SUCCESS' %}
            <b style="color: green">{{ txs }}</b>
          {% else %}
            {{ txs }}
          {% endif %}
        </td>
        <td>{{ s.plazaId|default('') }}</td>
        <td>{{ s.laneId|default('') }}</td>
        <td>{{ s.settleDate|default('') }}</td>
        <td>{{ s.txnDate|default('') }}</td>
        <td>{{ s.txnlist_FareType|default('') }}</td>
        <td>{{ s.txnlist_RegNumber|default('') }}</td>
        <td>{{ s.txnlist_TollFare|default('') }}</td>
        <td>{{ s.txnlist_VehicleClass|default('') }}</td>
        <td>{{ s.txnlist_errCode|default('') }}</td>
        <td>{{ s.txnlist_txnReaderTime|default('') }}</td>
        <td>{{ s.txnlist_txnReceivedTime|default('') }}</td>
        <td>{{ s.txnlist_txnStatus|default('') }}</td>
        <td>{{ s.txnlist_txnType|default('') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
{% endblock %} 