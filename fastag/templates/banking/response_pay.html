{% extends 'base.html' %}
{% block title %}Response Pay - Banking{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2>Response Pay</h2>
  <hr>
  <h5>Pay Request Logs</h5>
  <form method="post" id="statusForm">
    <table class="table table-bordered table-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th>Msg ID</th>
          <th>Org ID</th>
          <th>Tag ID</th>
          <th>TID</th>
          <th>Vehicle No</th>
          <th>Amount</th>
          <th>Time</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>{{ log.id }}</td>
          <td>{{ log.msg_id }}</td>
          <td>{{ log.org_id }}</td>
          <td>{{ log.tag_id }}</td>
          <td>{{ log.tid }}</td>
          <td>{{ log.vehicle_reg_no }}</td>
          <td>{{ log.amount }}</td>
          <td>{{ log.request_time }}</td>
          <td>
            <button type="submit" name="log_id" value="{{ log.id }}" class="btn btn-primary btn-sm">Get Status</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
  <h5>Response</h5>
  <div id="response">
    {% if response %}
      <pre>{{ response|safe }}</pre>
    {% endif %}
  </div>
  {% if status_list %}
  <h5>Transaction Status Details</h5>
  <table class="table table-bordered table-sm">
    <thead>
      <tr>
        <th>txnId</th>
        <th>result</th>
        <th>errCode</th>
        <th>txnStatus</th>
        <th>plazaId</th>
        <th>laneId</th>
        <th>settleDate</th>
        <th>txnDate</th>
        <th>txnlist_FareType</th>
        <th>txnlist_RegNumber</th>
        <th>txnlist_TollFare</th>
        <th>txnlist_VehicleClass</th>
        <th>txnlist_errCode</th>
        <th>txnlist_txnReaderTime</th>
        <th>txnlist_txnReceivedTime</th>
        <th>txnlist_txnStatus</th>
        <th>txnlist_txnType</th>
      </tr>
    </thead>
    <tbody>
      {% for s in status_list %}
      <tr>
        <td>{{ s.txnId|default('') }}</td>
        <td>{{ s.result|default('') }}</td>
        <td>{{ s.errCode|default('') }}</td>
        <td>
          {% set txs = s.txnlist_txnStatus|default('') %}
          {% if txs == 'FAILURE' %}
            <b style="color: red">{{ txs }}</b>
          {% elif txs == 'SUCCESS' %}
            <b style="color: green">{{ txs }}</b>
          {% else %}
            {{ txs }}
          {% endif %}
        </td>
        <td>{{ s.plazaId|default('') }}</td>
        <td>{{ s.laneId|default('') }}</td>
        <td>{{ s.settleDate|default('') }}</td>
        <td>{{ s.txnDate|default('') }}</td>
        <td>{{ s.txnlist_FareType|default('') }}</td>
        <td>{{ s.txnlist_RegNumber|default('') }}</td>
        <td>{{ s.txnlist_TollFare|default('') }}</td>
        <td>{{ s.txnlist_VehicleClass|default('') }}</td>
        <td>{{ s.txnlist_errCode|default('') }}</td>
        <td>{{ s.txnlist_txnReaderTime|default('') }}</td>
        <td>{{ s.txnlist_txnReceivedTime|default('') }}</td>
        <td>{{ s.txnlist_txnStatus|default('') }}</td>
        <td>{{ s.txnlist_txnType|default('') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
{% endblock %} 